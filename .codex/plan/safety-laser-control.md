# 安全激光控制开发计划

## 背景
- 项目：STM32F103RCT6 云台控制系统
- 需求：实现 CH5 保险拨杆锁定逻辑与 CH8 激光控制，同时满足锁定优先、平滑回中、失联自动关闭激光和联动约束。
- 上游接口：CRSF 通道解析（16 通道）、舵机控制（俯仰/水平双轴）、GPIO PA7 激光输出。

## 已确认约束
1. 安全逻辑需集中封装在新模块 `safety_control.c/h`，暴露初始化、周期更新与查询接口。
2. 锁定状态优先级最高，必须强制回中并关闭激光。
3. 需要通道值滞环防抖和 CRSF 失联保护。
4. 调试输出需可控，避免生产环境冗余日志。

## 待确认事项
1. 舵机回中策略：立即回中、渐进回中或可配置？
2. 激光超时策略：自动关闭、保持或可配置？是否需要激光硬件参数？
3. 调试输出粒度：详尽、精简或宏控制？

## 执行步骤
1. 与需求方确认上述待定策略，转化为模块常量或宏。
2. 审阅既有 CRSF、舵机、GPIO 初始化代码，整理可调用接口与更新频率。
3. 设计 `Core/Inc/safety_control.h`，定义枚举、数据结构及公开 API。
4. 实现 `Core/Src/safety_control.c`，完成状态机、滞环、防抖、回中和激光控制。
5. 在系统初始化与主循环中集成安全模块调用，确保锁定优先与失联联动。
6. 必要时更新相关头文件声明或注释，保证依赖清晰且遵守现有编码规范。
7. 运行 `make all` 验证编译，通过后准备优化阶段的自检。

## 质量检查
- 代码遵循 SOLID：安全逻辑单一职责，模块间依赖通过抽象接口。
- KISS & YAGNI：仅实现确认需求，不预留未使用扩展。
- DRY：复用现有舵机与 CRSF 功能，避免重复实现。
- 测试：编译无告警；硬件验证计划留待后续迭代执行。
